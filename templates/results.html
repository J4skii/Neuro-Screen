{% extends "base.html" %}
{% block title %}Results{% endblock %}
{% block content %}
<script src='https://cdn.jsdelivr.net/npm/chart.js'></script>
<h1 class='text-2xl font-bold mb-4'>{{ result.type }} Result</h1>
<div class='bg-white dark:bg-gray-800 p-6 rounded shadow mb-6'>
  <p class='text-lg'>Score: <strong>{{ result.score }}/{{ result.total_questions or 5 }}</strong></p>
  <p class='font-semibold'>{{ result.message }}</p>
</div>
<div class='grid md:grid-cols-2 gap-6'>
  <canvas id='doughnut'></canvas>
  <div class='bg-white dark:bg-gray-800 p-4 rounded shadow'>
    <h2 class='font-semibold mb-2'>Breakdown</h2>
    {% if result.type == 'Working Memory' %}
      <p>True Positives: {{ result.breakdown.true_positives|length }}</p>
      <p>False Positives: {{ result.breakdown.false_positives|length }}</p>
      <p>Missed: {{ result.breakdown.missed|length }}</p>
      <div class='mt-3 text-sm text-gray-600 dark:text-gray-300'>
        <div>Correct set: {{ result.breakdown.correct_set }}</div>
        <div>Selected: {{ result.breakdown.selected_set }}</div>
      </div>
    {% else %}
      <ul class='list-disc ml-6'>
      {% for q,info in result.breakdown.items() %}
        <li>Question {{ loop.index }} — Correct: <code>{{ info.correct }}</code> • You: <code>{{ info.given }}</code></li>
      {% endfor %}
      </ul>
    {% endif %}
  </div>
</div>
<div class='mt-6'><a href='{{ url_for("index") }}' class='px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700'>Home</a></div>
<script>
  const total = {{ result.total_questions or 5 }};
  const score = {{ result.score }};
  const ctx = document.getElementById('doughnut').getContext('2d');
  new Chart(ctx, { type:'doughnut', data:{ labels:['Correct','Incorrect'], datasets:[{ data:[score, total - score] }] }, options:{ responsive:true, animation:{ animateRotate:true, duration:1200 } } });
</script>
{% endblock %}